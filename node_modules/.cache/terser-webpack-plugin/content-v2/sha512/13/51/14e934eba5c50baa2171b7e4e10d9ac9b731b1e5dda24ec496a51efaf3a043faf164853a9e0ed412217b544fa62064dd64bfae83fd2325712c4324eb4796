{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"chunk-0374dbab\"],{\"73d7\":function(t,e,a){\"use strict\";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a(\"div\",{staticClass:\"specify-activitytype chart-simple\"},[a(\"div\",{staticClass:\"chart\"},[a(\"div\",{staticClass:\"chart-filter flex-wrap\"},[a(\"div\",{staticClass:\"time-range-wrap flex\"},[a(\"date-range-picker\",{attrs:{\"time-range\":t.baseTime,\"default-today\":!0},on:{\"update:timeRange\":function(e){t.baseTime=e},\"update:time-range\":function(e){t.baseTime=e}}}),t._v(\" \"),a(\"el-button\",{staticClass:\"getChartData\",attrs:{type:\"primary\",size:\"small\"},on:{click:t.handleChartBtnClick}},[t._v(\"搜索\")])],1)]),t._v(\" \"),a(\"div\",{staticClass:\"page-desc\"},[t._v(t._s(t.$route.meta.title)+\"：当前日期中，各活动的发布数量。\")]),t._v(\" \"),a(\"el-radio-group\",{staticClass:\"radio-group\",attrs:{size:\"mini\"},on:{change:t.handleRadioChange},model:{value:t.chartRadio,callback:function(e){t.chartRadio=e},expression:\"chartRadio\"}},[a(\"el-radio-button\",{attrs:{label:\"all\"}},[t._v(\"全部\")]),t._v(\" \"),a(\"el-radio-button\",{attrs:{label:\"customize\"}},[t._v(\"自定义\")])],1),t._v(\" \"),Object.keys(t.chartData).length?a(\"chart\",{directives:[{name:\"loading\",rawName:\"v-loading\",value:t.loadingMap.chartLoading,expression:\"loadingMap.chartLoading\"}],ref:\"chart\",attrs:{\"chart-option\":t.chartOptionWatcher}}):t._e()],1),t._v(\" \"),t.tableData.length?a(\"div\",{staticClass:\"table-wrap\"},[a(\"div\",{staticClass:\"table-head flex\"},[a(\"div\",{domProps:{textContent:t._s(t.tableHead)}}),t._v(\" \"),a(\"div\",[a(\"el-button\",{attrs:{type:\"primary\",size:\"mini\"},on:{click:t.exportData}},[t._v(\"下载数据\")])],1)]),t._v(\" \"),a(\"el-table\",{directives:[{name:\"loading\",rawName:\"v-loading\",value:t.loadingMap.tableLoading,expression:\"loadingMap.tableLoading\"}],ref:t.tableRef,staticStyle:{width:\"100%\"},attrs:{data:t.tableData,border:!0,\"header-cell-style\":{textAlign:\"center\"},\"max-height\":t.tableHeight,\"tree-props\":{children:\"children\"},\"row-key\":\"id\",\"default-sort\":{prop:\"date\",order:\"descending\"}}},[a(\"el-table-column\",{attrs:{sortable:\"\",label:\"日期\",prop:\"date\",align:\"center\",fixed:\"\"}}),t._v(\" \"),a(\"el-table-column\",{attrs:{label:\"基础类型\",prop:\"base\",align:\"center\"}}),t._v(\" \"),a(\"el-table-column\",{attrs:{label:\"总计\",prop:\"baseValue\",align:\"center\"}}),t._v(\" \"),a(\"el-table-column\",{attrs:{label:\"自定义类型\",prop:\"manual\",align:\"center\"}}),t._v(\" \"),a(\"el-table-column\",{attrs:{label:\"总计\",prop:\"manualValue\",align:\"center\"}})],1)],1):t._e()])},n=[],r=(a(\"c5f6\"),a(\"768b\")),s=(a(\"ffc1\"),a(\"75fc\")),o=(a(\"ac6a\"),a(\"db72\")),c=a(\"9ed2\"),h={chartType:\"activitytype\",exceptProp:[\"date\"],baseType:[\"聚餐\",\"唱歌\",\"电影\",\"购物\",\"下午茶\",\"旅游\",\"健身\",\"密室\",\"桌游\",\"游戏\",\"酒吧\",\"温泉\"]},l={mixins:[c[\"a\"]],data:function(){return Object(o[\"a\"])(Object(o[\"a\"])({},h),{},{chartRadio:\"all\",customizeProp:[],tableHeight:700})},methods:{parseChartData:function(){var t=this;this.getAllKeys(),this.customizeProp=[],this.useProp.forEach((function(e){return t.baseType.some((function(t){return e===t}))||t.customizeProp.push(e)})),this.handleRadioChange(),this.showChart=!0},resetChart:function(){this.chartOption.option.xAxis=[],this.chartOption.option.series=[];var t=this.$common.deepCopy(this.xAxisTpl);t.data=this.chartData.map((function(t){return t.date})),this.chartOption.option.xAxis.push(t)},allChart:function(){var t=this;if(this.resetChart(),this.useProp.forEach((function(e){var a=t.$common.deepCopy(t.seriesTpl);t.baseType.some((function(t){return e===t}))&&(a.name=e,a.data=t.chartData.map((function(t){return t[e]}))),t.chartOption.option.series.push(a)})),this.customizeProp.length){var e=this.$common.deepCopy(this.seriesTpl);e.name=\"自定义\",e.data=this.chartData.map((function(e){var a=0;return t.customizeProp.forEach((function(t){a+=e[t]||0})),a})),this.chartOption.option.series.push(e)}this.chartOption.option.legend.data=[].concat(Object(s[\"a\"])(this.useProp),[\"自定义\"])},customizeChart:function(){var t=this;this.resetChart(),this.customizeProp.forEach((function(e){var a=t.$common.deepCopy(t.seriesTpl);a.name=e,a.data=t.chartData.map((function(t){return t[e]})),t.chartOption.option.series.push(a)})),this.chartOption.option.legend.data=this.customizeProp},parseTableData:function(){var t=this;this.tableData=this.chartData.map((function(e,a){var i={};i.date=e.date,i.children=[],i.id=\"date-key-\".concat(a);var n=[],s=[],c=0,h=0;return Object.entries(e).forEach((function(e){var a=Object(r[\"a\"])(e,2),i=a[0],o=a[1];\"date\"!==i&&(t.baseType.some((function(t){return t===i}))?(c+=Number(o),n.push({base:i,baseValue:o})):(h+=Number(o),s.push({manual:i,manualValue:o})))})),i.base=\"基础类型总计\",i.baseValue=c,i.manual=\"自定义类型总计\",i.manualValue=h,n.forEach((function(t,e){var n=\"date-key-\".concat(a,\"-base-\").concat(e);i.children.push(Object(o[\"a\"])(Object(o[\"a\"])(Object(o[\"a\"])({},t),s.shift()),{},{id:n}))})),s.forEach((function(t,e){var n=\"date-key-\".concat(a,\"-manual-\").concat(e);i.children.push(Object(o[\"a\"])(Object(o[\"a\"])({},t),{},{id:n}))})),i})),this.tableHead=this.baseTime.map((function(e){return t.$day(e).format(\"YYYY-MM-DD\")})).join(\" — \")},handleRadioChange:function(t){var e=this.chartRadio;\"all\"===e?this.allChart():this.customizeChart()},exportData:function(){var t=this,e=[\"日期\",\"基础类型\",\"总计\",\"自定义类型\",\"总计\"],i=this.tableHead+this.chartTitle,n=this.tableData.map((function(e){var a=[];return a.push([e.date,\"\",\"\",\"\",\"\"]),e.children.map((function(e){var i=t.$common.deepCopy(e);delete i.id;var n=i.base,r=i.baseValue,s=i.manual,o=i.manualValue;a.push([\"\",n,r,s,o])})),a})).flat(1);Promise.all([a.e(\"chunk-782a4939\"),a.e(\"chunk-581b2547\")]).then(a.bind(null,\"4bf8d\")).then((function(t){t.export_json_to_excel({header:e,data:n,filename:i,autoWidth:!0,bookType:\"xlsx\"})}))}}},u=l,d=a(\"2877\"),p=Object(d[\"a\"])(u,i,n,!1,null,null,null);e[\"default\"]=p.exports},\"75fc\":function(t,e,a){\"use strict\";var i=a(\"a745\"),n=a.n(i),r=a(\"db2a\");function s(t){if(n()(t))return Object(r[\"a\"])(t)}var o=a(\"774e\"),c=a.n(o),h=a(\"c8bb\"),l=a.n(h),u=a(\"67bb\"),d=a.n(u);function p(t){if(\"undefined\"!==typeof d.a&&l()(Object(t)))return c()(t)}var f=a(\"e630\");function b(){throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function m(t){return s(t)||p(t)||Object(f[\"a\"])(t)||b()}a.d(e,\"a\",(function(){return m}))},8615:function(t,e,a){var i=a(\"5ca1\"),n=a(\"504c\")(!1);i(i.S,\"Object\",{values:function(t){return n(t)}})},\"9ed2\":function(t,e,a){\"use strict\";var i=a(\"75fc\"),n=(a(\"456d\"),a(\"8615\"),a(\"ac6a\"),a(\"768b\")),r=(a(\"55dd\"),a(\"96cf\"),a(\"3b8d\")),s=(a(\"a503\"),a(\"e48d\")),o=a(\"9f2d\"),c=a(\"2817\"),h=a(\"e33a\"),l=a(\"7346\"),u=a(\"37b6\");e[\"a\"]={mixins:[h[\"a\"],l[\"a\"]],components:{Chart:c[\"a\"],dateRangePicker:s[\"a\"]},data:function(){var t=this.$day(new Date).subtract(1,\"day\").toDate();return{seriesItemColor:u[\"m\"],baseTime:[t,t],useProp:[],chartData:{},tableHeight:400,tableHead:\"\",loadingMap:{chartLoading:!1},xAxisTpl:{type:\"category\",data:[]},chartTitle:this.$route.meta.title,seriesTpl:{name:\"\",type:\"line\",smooth:!0,data:[]},chartOption:{option:{title:{text:\"\",top:\"3%\",left:\"center\"},tooltip:{trigger:\"axis\",axisPointer:{type:\"shadow\"}},toolbox:{show:!0,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:[\"line\",\"bar\"]},restore:{show:!0},saveAsImage:{show:!0}}},dataZoom:[{show:!0,start:0,end:100,xAxisIndex:[0]},{type:\"inside\",start:0,end:100},{show:!0,yAxisIndex:0,filterMode:\"filter\",width:30,height:\"65%\",showDataShadow:!1,left:\"93%\",top:\"100\",bottom:\"100\"}],legend:{top:\"50\",data:[]},grid:{top:\"100\",bottom:\"70\"},xAxis:[{}],yAxis:[{type:\"value\",minInterval:1}],series:[]}}}},computed:{isTimeSelected:function(){return this.baseTime.every((function(t){return t}))},chartOptionWatcher:function(){var t=this.chartOption;return t.option.title.text=this.chartTitle,t}},created:function(){this.handleChartBtnClick()},methods:{handleChartBtnClick:function(){var t=Object(r[\"a\"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!this.isTimeSelected){t.next=16;break}return t.prev=1,this.loadingMap.tableLoading=!0,this.loadingMap.chartLoading=!0,t.next=6,this.wrapGetChartData(this.chartType);case 6:this.chartData&&(this.parseChartData(),this.parseTableData()),t.next=12;break;case 9:t.prev=9,t.t0=t[\"catch\"](1),console.log(t.t0);case 12:return t.prev=12,this.loadingMap.tableLoading=!1,this.loadingMap.chartLoading=!1,t.finish(12);case 16:case\"end\":return t.stop()}}),t,this,[[1,9,12,16]])})));function e(){return t.apply(this,arguments)}return e}(),wrapGetChartData:function(){var t=Object(r[\"a\"])(regeneratorRuntime.mark((function t(e){var a,i=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.getChartData(e,this.baseTime);case 2:a=t.sent,this.chartData=a.sort((function(t,e){var a=i.$day(t.date),n=i.$day(e.date);return a.isAfter(n)?1:-1}));case 4:case\"end\":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),getChartData:function(){var t=Object(r[\"a\"])(regeneratorRuntime.mark((function t(e,a){var i,r,s,c,h,l=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=a.map((function(t){return l.$day(t).format(\"YYYY-MM-DD\")})),r=Object(n[\"a\"])(i,2),s=r[0],c=r[1],t.next=3,Object(o[\"a\"])({type:e,startDate:s,endDate:c});case 3:return h=t.sent,t.abrupt(\"return\",h.hasOwnProperty(\"data\")&&Array.isArray(h.data)&&h.data.length?h.data:[]);case 5:case\"end\":return t.stop()}}),t)})));function e(e,a){return t.apply(this,arguments)}return e}(),parseChartData:function(){var t=this;this.chartOption.option.xAxis=[],this.chartOption.option.series=[];var e=this.$common.deepCopy(this.xAxisTpl);e.data=this.chartData.map((function(t){return t.date})),this.chartOption.option.xAxis.push(e),this.getAllKeys(),this.useProp.forEach((function(e){var a=t.$common.deepCopy(t.seriesTpl);a.name=t.columnLable?t.columnLable[e]:e,a.data=t.chartData.map((function(t){return t[e]})),t.chartOption.option.series.push(a)})),this.chartOption.option.legend.data=this.columnLable?Object.values(this.columnLable):this.useProp,this.showChart=!0},getAllKeys:function(){var t=this;if(this.exceptProp){var e={};this.chartData.forEach((function(a){var i=Object.keys(a).filter((function(e){return t.exceptProp.every((function(t){return t!==e}))}));i.forEach((function(t){e[t]=1}))})),this.useProp=Object.keys(e)}else this.useProp=this.sortOrder},parseTableData:function(){var t=this;this.tableData=this.chartData,this.tableHead=this.baseTime.map((function(e){return t.$day(e).format(\"YYYY-MM-DD\")})).join(\" — \"),this.loadingMap.tableLoading=!1},exportData:function(){var t=[\"日期\"].concat(Object(i[\"a\"])(this.columnLable?Object.values(this.columnLable):this.useProp)),e=[\"date\"].concat(Object(i[\"a\"])(this.useProp)),n=this.tableHead+this.chartTitle,r=this.tableData.map((function(t){return e.map((function(e){return t[e]}))}));Promise.all([a.e(\"chunk-782a4939\"),a.e(\"chunk-581b2547\")]).then(a.bind(null,\"4bf8d\")).then((function(e){e.export_json_to_excel({header:t,data:r,filename:n,autoWidth:!0,bookType:\"xlsx\"})}))}}}},\"9f2d\":function(t,e,a){\"use strict\";a.d(e,\"a\",(function(){return n})),a.d(e,\"d\",(function(){return r})),a.d(e,\"b\",(function(){return s})),a.d(e,\"c\",(function(){return o}));var i=a(\"b775\");function n(t){return Object(i[\"a\"])({url:\"/tool/get_statistics\",method:\"get\",params:t})}function r(t){return Object(i[\"a\"])({url:\"/tool/sum_statistics\",method:\"get\",params:t})}function s(t){return Object(i[\"a\"])({url:\"/tool/get_user_stay\",method:\"get\",params:t})}function o(t){return Object(i[\"a\"])({url:\"/tool/get_user_trace\",method:\"get\",params:t})}},a503:function(t,e,a){},e33a:function(t,e,a){\"use strict\";a(\"ac6a\"),a(\"456d\");var i=a(\"9abb\"),n={components:{Paginationtpl:i[\"a\"]},data:function(){return{pagination:{page:1,pageSize:10},paginationTotal:0}},watch:{pagination:{handler:function(){this.getData()},deep:!0}},methods:{resetPagination:function(){this.pagination={page:1,pageSize:10}}}};e[\"a\"]={mixins:[n],data:function(){return{tableRef:\"mainTable\",tableData:[],catchedDataArr:[],catchedData:{},catchedRadio:null,tableSelected:!1,tableHeight:200,extraHeight:110,loadingMap:{tableLoading:!0}}},computed:{isTableRadioSelected:function(){return Object.keys(this.catchedData).length},isTableCheckBoxSelected:function(){return this.catchedDataArr.length>0}},methods:{handleTableCheckBoxSelect:function(t){this.catchedDataArr=t,this.tableSelected=this.$refs[this.tableRef].selection.length>0},handleTabelRadioClick:function(t){this.catchedRadio=t,this.catchedData=this.tableData[t]},handleTableItemClick:function(t){this.catchedData=t},setTableHeightBySelf:function(){var t=this.$refs[this.searchRef],e=t&&t.$el.clientHeight||0;this.tableHeight=this.$el.clientHeight-this.extraHeight-e},setTableHeightByParent:function(){var t=this.$refs[this.searchRef],e=t&&t.$el.clientHeight||0;this.tableHeight=this.$parent.$el.clientHeight-this.extraHeight-e},watchResizeFinish:function(t,e){return e&&clearTimeout(e),e=setTimeout((function(){return new Promise((function(e){return e(t())}))}),300),e},addTabelHeightListener:function(){var t,e=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"self\",i=\"self\"===a?this.$el:this.$parent.$el,n=\"self\"===a?this.setTableHeightBySelf:this.setTableHeightByParent;this.$erd.listenTo(i,(function(a){t=e.watchResizeFinish(n,t)}))},isTableSelected:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"请先选择需要修改的数据\";return!(!this.isTableRadioSelected&&!this.isTableCheckBoxSelected)||(this.$message({type:\"warning\",message:t}),!1)},formatColumn:function(t,e,a,i){return null===a||\"\"===a||void 0===a?\"--\":a}},beforeDestroy:function(){this.$erd.removeAllListeners(this.$el)}}},e48d:function(t,e,a){\"use strict\";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a(\"el-date-picker\",{attrs:{type:t.type,align:\"right\",\"unlink-panels\":\"\",\"range-separator\":\"至\",\"start-placeholder\":\"开始日期\",\"end-placeholder\":\"结束日期\",\"picker-options\":t.pickerOptions,size:\"small\"},model:{value:t.pickTimeRange,callback:function(e){t.pickTimeRange=e},expression:\"pickTimeRange\"}})},n=[],r=a(\"37b6\"),s={props:{type:{type:String,default:\"daterange\"},timeRange:{type:Array,default:function(){return[]}},defaultToday:{type:Boolean,default:!1}},data:function(){return{pickerOptions:r[\"l\"],pickTimeRange:[]}},watch:{pickTimeRange:function(t){this.$emit(\"update:timeRange\",t)}},created:function(){if(this.defaultToday){var t=this.$day(new Date).subtract(1,\"day\").toDate();this.pickTimeRange=[t,t]}else{var e=new Date;this.pickTimeRange=[this.$day(e).subtract(30,\"day\").toDate(),e]}}},o=s,c=a(\"2877\"),h=Object(c[\"a\"])(o,i,n,!1,null,null,null);e[\"a\"]=h.exports}}]);","extractedComments":[]}