{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"chunk-ff44c58a\"],{\"36bd\":function(e,t,a){\"use strict\";var n=a(\"4bf8\"),r=a(\"77f1\"),i=a(\"9def\");e.exports=function(e){var t=n(this),a=i(t.length),s=arguments.length,l=r(s>1?arguments[1]:void 0,a),o=s>2?arguments[2]:void 0,c=void 0===o?a:r(o,a);while(c>l)t[l++]=e;return t}},\"6c7b\":function(e,t,a){var n=a(\"5ca1\");n(n.P,\"Array\",{fill:a(\"36bd\")}),a(\"9c6c\")(\"fill\")},\"9f2d\":function(e,t,a){\"use strict\";a.d(t,\"a\",(function(){return r})),a.d(t,\"d\",(function(){return i})),a.d(t,\"b\",(function(){return s})),a.d(t,\"c\",(function(){return l}));var n=a(\"b775\");function r(e){return Object(n[\"a\"])({url:\"/tool/get_statistics\",method:\"get\",params:e})}function i(e){return Object(n[\"a\"])({url:\"/tool/sum_statistics\",method:\"get\",params:e})}function s(e){return Object(n[\"a\"])({url:\"/tool/get_user_stay\",method:\"get\",params:e})}function l(e){return Object(n[\"a\"])({url:\"/tool/get_user_trace\",method:\"get\",params:e})}},aea59:function(e,t,a){\"use strict\";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a(\"div\",{staticClass:\"keep-analyse\"},[a(\"div\",{staticClass:\"flex search-bar\"},[a(\"el-form\",{ref:e.searchRef,staticClass:\"filter flex-wrap\",attrs:{model:e.searchForm,rules:e.formRules}},[a(\"el-form-item\",{staticClass:\"flex filter-item\",attrs:{label:\"时间范围\",prop:\"dateRange\"}},[a(\"el-date-picker\",{attrs:{type:\"daterange\",align:\"right\",\"unlink-panels\":\"\",\"range-separator\":\"至\",\"start-placeholder\":\"开始日期\",\"end-placeholder\":\"结束日期\",\"picker-options\":e.pickerOptions,size:\"small\"},model:{value:e.searchForm.dateRange,callback:function(t){e.$set(e.searchForm,\"dateRange\",t)},expression:\"searchForm.dateRange\"}})],1),e._v(\" \"),a(\"el-form-item\",{staticClass:\"flex filter-item\",attrs:{label:\"留存天数\",prop:\"stayCount\"}},[a(\"el-input\",{attrs:{type:\"text\",placeholder:\"留存天数少于...\"},model:{value:e.searchForm.stayCount,callback:function(t){e.$set(e.searchForm,\"stayCount\",t)},expression:\"searchForm.stayCount\"}})],1)],1),e._v(\" \"),a(\"div\",{staticClass:\"search-btnGroup flex\"},[a(\"el-button\",{attrs:{type:\"primary\"},on:{click:e.getPageData}},[e._v(\"搜索\")]),e._v(\" \"),a(\"el-button\",{attrs:{type:\"primary\"},on:{click:e.resetForm}},[e._v(\"重置\")])],1)],1),e._v(\" \"),a(\"el-table\",{directives:[{name:\"loading\",rawName:\"v-loading\",value:e.loadingMap.tableLoading,expression:\"loadingMap.tableLoading\"}],ref:e.tableRef,staticStyle:{width:\"100%\"},attrs:{data:e.tableData,border:!0,\"header-cell-style\":{textAlign:\"center\"},height:e.tableHeight,\"cell-style\":e.getColumnStyle,\"default-sort\":{prop:\"loginDate\",order:\"descending\"}}},[a(\"el-table-column\",{attrs:{sortable:\"\",label:\"日期\",align:\"center\",prop:\"loginDate\",fixed:\"\"}}),e._v(\" \"),a(\"el-table-column\",{attrs:{sortable:\"\",label:\"用户数\",align:\"center\",prop:\"base\"}}),e._v(\" \"),e._l(e.keepColumn,(function(t){return a(\"el-table-column\",{key:\"column-keepday-\"+t.keepDay,attrs:{sortable:\"\",label:t.label,align:\"center\",prop:t.keepDay,formatter:e.getKeepPersent}})}))],2)],1)},r=[],i=(a(\"7514\"),a(\"5df3\"),a(\"96cf\"),a(\"3b8d\")),s=(a(\"c5f6\"),a(\"6c7b\"),a(\"768b\")),l=(a(\"ac6a\"),a(\"ffc1\"),a(\"db72\")),o=a(\"e33a\"),c=a(\"7346\"),u=a(\"9f2d\"),h=a(\"37b6\"),d=a(\"5a0c\"),f=a.n(d),p=new Date,b=[f()(p).subtract(30,\"day\").toDate(),p],g={searchForm:{dateRange:b,stayCount:30},formRules:{dateRange:{required:!0,message:\"请选择日期\",trigger:\"blur\"},stayCount:{required:!0,message:\"请输入停留天数\",trigger:\"blur\"}}},m={mixins:[o[\"a\"],c[\"c\"]],data:function(){return Object(l[\"a\"])(Object(l[\"a\"])({},g),{},{pickerOptions:h[\"l\"],extraHeight:0,keepDay:[1,2,3,4,5,6,7,14,30,60,90],keepColumn:[{label:\"+1日\",keepDay:\"1\"},{label:\"+2日\",keepDay:\"2\"},{label:\"+3日\",keepDay:\"3\"},{label:\"+4日\",keepDay:\"4\"},{label:\"+5日\",keepDay:\"5\"},{label:\"+6日\",keepDay:\"6\"},{label:\"+7日\",keepDay:\"7\"},{label:\"+14日\",keepDay:\"14\"},{label:\"+1月\",keepDay:\"30\"},{label:\"+2月\",keepDay:\"60\"},{label:\"+3月\",keepDay:\"90\"}],loadingMap:{tableLoading:!1}})},beforeMount:function(){var e=this;this.$nextTick((function(){e.addTabelHeightListener(\"parent\"),e.getPageData()}))},methods:{generateData:function(e){var t=this;console.log(e);var a=Object.entries(e).reduce((function(e,a){var n=Object(s[\"a\"])(a,2),r=n[0],i=n[1];return e[r]=\"stayCount\"===r?i:t.$day(i),e}),{}),n=a.startDate,r=a.endDate,i=a.stayCount,l=Math.abs(n.diff(r,\"day\"));return Array(l).fill(\"\").map((function(e,t){var a=n.add(t,\"day\"),r=Math.floor(1e3*Math.random());return Array(Number(i)+1).fill(\"\").map((function(e,t){return r=parseInt(r*(1-Math.floor(30*Math.random())/100)),{loginDate:a.format(\"YYYY-MM-DD\"),stayDate:a.add(t,\"day\").format(\"YYYY-MM-DD\"),stayCount:t,count:r}}))})).flat(1/0)},getPageData:function(){var e=Object(i[\"a\"])(regeneratorRuntime.mark((function e(){var t,a,n,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.$common.checkFormValid(this,this.searchRef)){e.next=20;break}return e.prev=1,this.loadingMap.tableLoading=!0,t=this.parseForm(),e.next=6,Promise.all([this.getKeepData(t),this.getRegisData(t)]);case 6:a=e.sent,n=Object(s[\"a\"])(a,2),r=n[0],i=n[1],this.tableData=this.parseTabelData(i,r),e.next=17;break;case 13:e.prev=13,e.t0=e[\"catch\"](1),console.log(e.t0),this.tableData=[];case 17:return e.prev=17,this.loadingMap.tableLoading=!1,e.finish(17);case 20:case\"end\":return e.stop()}}),e,this,[[1,13,17,20]])})));function t(){return e.apply(this,arguments)}return t}(),getRegisData:function(){var e=Object(i[\"a\"])(regeneratorRuntime.mark((function e(t){var a,n,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=\"register\",n=t.startDate,r=t.endDate,e.next=4,Object(u[\"a\"])({type:a,startDate:n,endDate:r});case 4:return i=e.sent,e.abrupt(\"return\",i.data);case 6:case\"end\":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),getKeepData:function(){var e=Object(i[\"a\"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(u[\"b\"])(t);case 2:return a=e.sent,e.abrupt(\"return\",a.data);case 4:case\"end\":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),parseTabelData:function(e,t){var a=this;return t=t.reduce((function(e,t){return e[t.loginDate]||(e[t.loginDate]={}),e[t.loginDate][t.stayCount]=t.count,e}),{}),e.map((function(e){var n=e.date,r=e.count,i=n,s={loginDate:i};return s.base=r,t[i]&&t[i].hasOwnProperty(\"1\")&&a.keepDay.forEach((function(e){s[e]=t[i][e]})),s}))},getKeepPersent:function(e,t,a){var n=\"N/A\";return\"number\"===typeof a&&(n=0===e.base?\"0%\":(a/e.base*100).toFixed(1)+\"%\"),n},getColumnStyle:function(e){var t=e.row,a=e.column,n=(e.rowIndex,e.columnIndex,t[a.property]);if(\"number\"===typeof n&&0!==t.base){var r=(n/t.base*100).toFixed(1),i=h[\"j\"].find((function(e){return r>=e.min&&r<=e.max}));return i&&{backgroundColor:i.background,color:i.color||\"#000\"}}},parseForm:function(){var e=this,t=this.searchForm.dateRange.map((function(t){return e.$day(t).format(\"YYYY-MM-DD\")})),a=Object(s[\"a\"])(t,2),n=a[0],r=a[1],i=this.searchForm.stayCount;return{startDate:n,endDate:r,stayCount:i}}}},y=m,D=a(\"2877\"),v=Object(D[\"a\"])(y,n,r,!1,null,null,null);t[\"default\"]=v.exports},e33a:function(e,t,a){\"use strict\";a(\"ac6a\"),a(\"456d\");var n=a(\"9abb\"),r={components:{Paginationtpl:n[\"a\"]},data:function(){return{pagination:{page:1,pageSize:10},paginationTotal:0}},watch:{pagination:{handler:function(){this.getData()},deep:!0}},methods:{resetPagination:function(){this.pagination={page:1,pageSize:10}}}};t[\"a\"]={mixins:[r],data:function(){return{tableRef:\"mainTable\",tableData:[],catchedDataArr:[],catchedData:{},catchedRadio:null,tableSelected:!1,tableHeight:200,extraHeight:110,loadingMap:{tableLoading:!0}}},computed:{isTableRadioSelected:function(){return Object.keys(this.catchedData).length},isTableCheckBoxSelected:function(){return this.catchedDataArr.length>0}},methods:{handleTableCheckBoxSelect:function(e){this.catchedDataArr=e,this.tableSelected=this.$refs[this.tableRef].selection.length>0},handleTabelRadioClick:function(e){this.catchedRadio=e,this.catchedData=this.tableData[e]},handleTableItemClick:function(e){this.catchedData=e},setTableHeightBySelf:function(){var e=this.$refs[this.searchRef],t=e&&e.$el.clientHeight||0;this.tableHeight=this.$el.clientHeight-this.extraHeight-t},setTableHeightByParent:function(){var e=this.$refs[this.searchRef],t=e&&e.$el.clientHeight||0;this.tableHeight=this.$parent.$el.clientHeight-this.extraHeight-t},watchResizeFinish:function(e,t){return t&&clearTimeout(t),t=setTimeout((function(){return new Promise((function(t){return t(e())}))}),300),t},addTabelHeightListener:function(){var e,t=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"self\",n=\"self\"===a?this.$el:this.$parent.$el,r=\"self\"===a?this.setTableHeightBySelf:this.setTableHeightByParent;this.$erd.listenTo(n,(function(a){e=t.watchResizeFinish(r,e)}))},isTableSelected:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"请先选择需要修改的数据\";return!(!this.isTableRadioSelected&&!this.isTableCheckBoxSelected)||(this.$message({type:\"warning\",message:e}),!1)},formatColumn:function(e,t,a,n){return null===a||\"\"===a||void 0===a?\"--\":a}},beforeDestroy:function(){this.$erd.removeAllListeners(this.$el)}}}}]);","extractedComments":[]}