{"remainingRequest":"/Users/zhaoguanglin/corgi-admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhaoguanglin/corgi-admin/src/views/matchMgr/calc/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zhaoguanglin/corgi-admin/src/views/matchMgr/calc/index.vue","mtime":1589962406516},{"path":"/Users/zhaoguanglin/corgi-admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhaoguanglin/corgi-admin/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhaoguanglin/corgi-admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/zhaoguanglin/corgi-admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhaoguanglin/corgi-admin/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { validUsername } from '@/utils/validate'\r\nimport { get_match_factor } from '@/api/matchMgr'\r\nimport { get_match_ratio } from '@/api/matchMgr'\r\nimport { set_match_ratio } from '@/api/matchMgr'\r\n\r\nexport default {\r\n  name: 'Login',\r\n  data() {\r\n    const validateUsername = (rule, value, callback) => {\r\n      // if (!validUsername(value)) {\r\n      //   callback(new Error('请输入有效用户名'))\r\n      // } else {\r\n      //   callback()\r\n      // }\r\n      if (!value) {\r\n        callback(new Error('请输入比例'))\r\n      }\r\n      callback()\r\n    }\r\n    return {\r\n      matchdata: {\r\n        role_factor: 0,\r\n        prefer_factor: 0,\r\n        con_factor: 0,\r\n        chara_factor: 0,\r\n        int_factor: 0\r\n      },\r\n      loginRules: {\r\n        role_factor: [{ required: true, trigger: 'blur', validator: validateUsername }],\r\n        con_factor: [{ required: true, trigger: 'blur', validator: validateUsername }],\r\n        prefer_factor: [{ required: true, trigger: 'blur', validator: validateUsername }],\r\n        int_factor: [{ required: true, trigger: 'blur', validator: validateUsername }],\r\n        chara_factor: [{ required: true, trigger: 'blur', validator: validateUsername }]\r\n      },\r\n      loading: false,\r\n      redirect: undefined\r\n    }\r\n  },\r\n  watch: {\r\n    $route: { \r\n      handler: function(route) {\r\n        this.redirect = route.query && route.query.redirect\r\n      },\r\n      immediate: true\r\n    }\r\n  },\r\n\r\n    created() {\r\n    this.get_match_ratio()\r\n  },\r\n  methods: {\r\n        async get_match_ratio() {\r\n      try {\r\n        const data = await get_match_ratio()\r\n        this.matchdata.role_factor = data.data.role_factor\r\n        this.matchdata.prefer_factor = data.data.prefer_factor\r\n        this.matchdata.con_factor = data.data.con_factor\r\n        this.matchdata.chara_factor = data.data.chara_factor\r\n        this.matchdata.int_factor = data.data.int_factor\r\n      } catch (err) {\r\n        console.log(err)\r\n      }\r\n    },\r\n        async set_match_ratio() {\r\n      try {\r\n        const data = await set_match_ratio({ ...this.matchdata })\r\n      } catch (err) {\r\n        console.log(err)\r\n      }\r\n    },\r\n    showPwd() {\r\n      if (this.passwordType === 'password') {\r\n        this.passwordType = ''\r\n      } else {\r\n        this.passwordType = 'password'\r\n      }\r\n      this.$nextTick(() => {\r\n        this.$refs.password.focus()\r\n      })\r\n    },\r\n    handleLogin() {\r\n      this.$refs.matchdata.validate(valid => {\r\n        if (valid) {\r\n\r\n          if((Number(this.matchdata.role_factor)+\r\n        Number(this.matchdata.prefer_factor)+\r\n        Number(this.matchdata.con_factor) +\r\n        Number(this.matchdata.chara_factor)+\r\n        Number(this.matchdata.int_factor))!=100)\r\n        {\r\n                    this.$message({ type: 'warning', message: '总和不为100' })\r\n          return false\r\n\r\n        }\r\n          this.loading = true\r\n          this.set_match_ratio()\r\n          this.loading = false\r\n          this.$message({ type: 'success', message: '修改成功' })\r\n        } else {\r\n          console.log('error submit!!')\r\n          return false\r\n        }\r\n      })\r\n    }\r\n  }\r\n}\r\n",null]}