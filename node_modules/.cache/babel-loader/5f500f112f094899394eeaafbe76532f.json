{"remainingRequest":"/Users/zhaoguanglin/Documents/corgi/corgi-admin/node_modules/thread-loader/dist/cjs.js!/Users/zhaoguanglin/Documents/corgi/corgi-admin/node_modules/babel-loader/lib/index.js!/Users/zhaoguanglin/Documents/corgi/corgi-admin/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/zhaoguanglin/Documents/corgi/corgi-admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhaoguanglin/Documents/corgi/corgi-admin/src/views/dataCenter/keep/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zhaoguanglin/Documents/corgi/corgi-admin/src/views/dataCenter/keep/index.vue","mtime":1589551163533},{"path":"/Users/zhaoguanglin/Documents/corgi/corgi-admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhaoguanglin/Documents/corgi/corgi-admin/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhaoguanglin/Documents/corgi/corgi-admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/zhaoguanglin/Documents/corgi/corgi-admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhaoguanglin/Documents/corgi/corgi-admin/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.find\";\nimport \"core-js/modules/es6.string.iterator\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/zhaoguanglin/Documents/corgi/corgi-admin/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/es6.array.fill\";\nimport _slicedToArray from \"/Users/zhaoguanglin/Documents/corgi/corgi-admin/node_modules/@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es7.object.entries\";\nimport _objectSpread from \"/Users/zhaoguanglin/Documents/corgi/corgi-admin/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread2\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport tableCommon from '@/mixins/tableCommon';\nimport { searchCommon } from '@/mixins/commonSet';\nimport { getStatistics, getUserStay } from '@/api/dataCenter';\nimport { pickerOptions, keepColumnStyle } from '@/utils/const';\nimport pageConfig from \"./pageConfig\";\nexport default {\n  mixins: [tableCommon, searchCommon],\n  data: function data() {\n    return _objectSpread(_objectSpread({}, pageConfig), {}, {\n      pickerOptions: pickerOptions,\n      extraHeight: 0,\n      keepDay: [1, 2, 3, 4, 5, 6, 7, 14, 30, 60, 90],\n      keepColumn: [{\n        label: '+1日',\n        keepDay: '1'\n      }, {\n        label: '+2日',\n        keepDay: '2'\n      }, {\n        label: '+3日',\n        keepDay: '3'\n      }, {\n        label: '+4日',\n        keepDay: '4'\n      }, {\n        label: '+5日',\n        keepDay: '5'\n      }, {\n        label: '+6日',\n        keepDay: '6'\n      }, {\n        label: '+7日',\n        keepDay: '7'\n      }, {\n        label: '+14日',\n        keepDay: '14'\n      }, {\n        label: '+1月',\n        keepDay: '30'\n      }, {\n        label: '+2月',\n        keepDay: '60'\n      }, {\n        label: '+3月',\n        keepDay: '90'\n      }],\n      loadingMap: {\n        tableLoading: false\n      }\n    });\n  },\n  beforeMount: function beforeMount() {\n    var _this = this;\n\n    this.$nextTick(function () {\n      _this.addTabelHeightListener('parent');\n\n      _this.getPageData();\n    });\n  },\n  methods: {\n    generateData: function generateData(params) {\n      var _this2 = this;\n\n      console.log(params);\n\n      var _Object$entries$reduc = Object.entries(params).reduce(function (data, _ref) {\n        var _ref2 = _slicedToArray(_ref, 2),\n            key = _ref2[0],\n            value = _ref2[1];\n\n        data[key] = key === 'stayCount' ? value : _this2.$day(value);\n        return data;\n      }, {}),\n          startDate = _Object$entries$reduc.startDate,\n          endDate = _Object$entries$reduc.endDate,\n          stayCount = _Object$entries$reduc.stayCount;\n\n      var diff = Math.abs(startDate.diff(endDate, 'day'));\n      return Array(diff).fill('').map(function (item, index) {\n        var loginDate = startDate.add(index, 'day');\n        var count = Math.floor(Math.random() * 1000);\n        return Array(Number(stayCount) + 1).fill('').map(function (keep, keepIndex) {\n          count = parseInt(count * (1 - Math.floor(Math.random() * 30) / 100));\n          return {\n            loginDate: loginDate.format('YYYY-MM-DD'),\n            stayDate: loginDate.add(keepIndex, 'day').format('YYYY-MM-DD'),\n            stayCount: keepIndex,\n            count: count\n          };\n        });\n      }).flat(Infinity);\n    },\n    getPageData: function () {\n      var _getPageData = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n        var searchForm, _yield$Promise$all, _yield$Promise$all2, keepData, regisData;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!this.$common.checkFormValid(this, this.searchRef)) {\n                  _context.next = 20;\n                  break;\n                }\n\n                _context.prev = 1;\n                this.loadingMap.tableLoading = true;\n                searchForm = this.parseForm();\n                _context.next = 6;\n                return Promise.all([this.getKeepData(searchForm), this.getRegisData(searchForm)]);\n\n              case 6:\n                _yield$Promise$all = _context.sent;\n                _yield$Promise$all2 = _slicedToArray(_yield$Promise$all, 2);\n                keepData = _yield$Promise$all2[0];\n                regisData = _yield$Promise$all2[1];\n                this.tableData = this.parseTabelData(regisData, keepData);\n                _context.next = 17;\n                break;\n\n              case 13:\n                _context.prev = 13;\n                _context.t0 = _context[\"catch\"](1);\n                console.log(_context.t0);\n                this.tableData = [];\n\n              case 17:\n                _context.prev = 17;\n                this.loadingMap.tableLoading = false;\n                return _context.finish(17);\n\n              case 20:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[1, 13, 17, 20]]);\n      }));\n\n      function getPageData() {\n        return _getPageData.apply(this, arguments);\n      }\n\n      return getPageData;\n    }(),\n    getRegisData: function () {\n      var _getRegisData = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(searchForm) {\n        var type, startDate, endDate, result;\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                type = 'register';\n                startDate = searchForm.startDate, endDate = searchForm.endDate;\n                _context2.next = 4;\n                return getStatistics({\n                  type: type,\n                  startDate: startDate,\n                  endDate: endDate\n                });\n\n              case 4:\n                result = _context2.sent;\n                return _context2.abrupt(\"return\", result.data);\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      function getRegisData(_x) {\n        return _getRegisData.apply(this, arguments);\n      }\n\n      return getRegisData;\n    }(),\n    getKeepData: function () {\n      var _getKeepData = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3(searchForm) {\n        var result;\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return getUserStay(searchForm);\n\n              case 2:\n                result = _context3.sent;\n                return _context3.abrupt(\"return\", result.data);\n\n              case 4:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      function getKeepData(_x2) {\n        return _getKeepData.apply(this, arguments);\n      }\n\n      return getKeepData;\n    }(),\n    parseTabelData: function parseTabelData(regisData, keepData) {\n      var _this3 = this;\n\n      keepData = keepData.reduce(function (obj, item) {\n        if (!obj[item.loginDate]) {\n          obj[item.loginDate] = {};\n        }\n\n        obj[item.loginDate][item.stayCount] = item.count;\n        return obj;\n      }, {});\n      return regisData.map(function (_ref3) {\n        var date = _ref3.date,\n            count = _ref3.count;\n        var loginDate = date;\n        var temp = {\n          loginDate: loginDate\n        };\n        temp.base = count;\n\n        if (keepData[loginDate] && keepData[loginDate].hasOwnProperty('1')) {\n          _this3.keepDay.forEach(function (keepDay) {\n            temp[keepDay] = keepData[loginDate][keepDay];\n          });\n        }\n\n        return temp;\n      });\n    },\n    getKeepPersent: function getKeepPersent(row, column, cellValue) {\n      var value = 'N/A';\n\n      if (typeof cellValue === 'number') {\n        if (row.base === 0) {\n          value = 0 + '%';\n        } else {\n          value = (cellValue / row.base * 100).toFixed(1) + '%';\n        }\n      }\n\n      return value;\n    },\n    getColumnStyle: function getColumnStyle(_ref4) {\n      var row = _ref4.row,\n          column = _ref4.column,\n          rowIndex = _ref4.rowIndex,\n          columnIndex = _ref4.columnIndex;\n      var value = row[column.property];\n\n      if (typeof value === 'number' && row.base !== 0) {\n        var persent = (value / row.base * 100).toFixed(1);\n        var check = keepColumnStyle.find(function (item) {\n          return persent >= item.min && persent <= item.max;\n        });\n        return check && {\n          backgroundColor: check.background,\n          color: check.color || '#000'\n        };\n      }\n    },\n    parseForm: function parseForm() {\n      var _this4 = this;\n\n      var _this$searchForm$date = this.searchForm.dateRange.map(function (date) {\n        return _this4.$day(date).format('YYYY-MM-DD');\n      }),\n          _this$searchForm$date2 = _slicedToArray(_this$searchForm$date, 2),\n          startDate = _this$searchForm$date2[0],\n          endDate = _this$searchForm$date2[1];\n\n      var stayCount = this.searchForm.stayCount;\n      return {\n        startDate: startDate,\n        endDate: endDate,\n        stayCount: stayCount\n      };\n    }\n  }\n};",null]}